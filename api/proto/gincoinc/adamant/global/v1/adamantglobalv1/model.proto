syntax = "proto3";

package adamant.global.v1;

option go_package = "adamantglobalv1";

import "google/protobuf/timestamp.proto";
import "validate/validate.proto";
import "gincoinc/global/v1/gincoincglobalv1/enum.proto";
import "gincoinc/adamant/global/v1/adamantglobalv1/enum.proto";
// =============================================================================
//  Model
// =============================================================================

message Wallet {
    string wallet_id = 1;
    string name = 2;
    gincoinc.global.v1.Coin coin = 3;
    uint32 hd_account = 17;
    WalletType wallet_type = 4;
    gincoinc.global.v1.AddressType address_type = 5;
    uint32 m = 6;
    uint32 n = 7;
    WalletState state = 8;
    repeated Key keys = 9;
    repeated WalletMember members = 10;
    uint32 required_approval_count = 20;
    double balance = 11;
    string string_balance = 12;
    string address = 13;
    string policy_id = 14;
    WalletProposal proposal = 18;
    string destination_wallet_id = 19;
    google.protobuf.Timestamp create_time = 15;
    google.protobuf.Timestamp update_time = 16;
}

message WalletProposal {
    adamant.global.v1.WalletProposalType proposal_type = 7 [(validate.rules).enum = {defined_only: true, not_in: [0]}];
    string requester_account_id = 1 [(validate.rules).string = {pattern: "^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$"}];
    string requester_name = 2;
    string approver_account_id = 3 [(validate.rules).string = {pattern: "^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$"}];
    string approver_name = 4;
    string proposed_policy = 5;
    repeated string proposed_validators = 8 [(validate.rules).repeated.items.string = {pattern: "^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$"}];
    uint32 proposed_required_approval_count = 9;
    bool is_reviewed = 6;
}

message WalletMember {
    string account_id = 1;
    adamant.global.v1.AccountType account_type = 2;
    string name = 3;
    string email = 4;
    RoleType role = 5;
    bool is_key_registered = 6;
    bool is_master = 7;
    bool is_validated_to_create_wallet = 8;
}

message Key {
    string wallet_id = 1;
    string account_id = 2;
    adamant.global.v1.AccountType account_type = 3;
    string key_id = 4;
    uint32 key_index = 5;
}

message Address {
    string wallet_id = 1;
    string address_id = 2;
    gincoinc.global.v1.Coin coin = 3;
    string address = 4;
    uint32 index = 5;
    double balance = 6;
    string string_balance = 7;
    AddressState state = 8;
    gincoinc.global.v1.AddressType address_type = 9;
    google.protobuf.Timestamp create_time = 11;
    google.protobuf.Timestamp update_time = 12;
}

message EthereumFeeAddress {
    string address = 1;
    double balance = 2;
    string string_balance = 3;
}

message Transaction {
    string wallet_id = 1;
    string transaction_id = 2;
    gincoinc.global.v1.Coin coin = 3;
    string tx_id = 4;
    string address = 5;
    double value = 6;
    string string_value = 7;
    double jpy_rate = 9;
    double fee = 10;
    string string_fee = 11;
    uint64 fee_rate = 12;
    TransactionState state = 13;
    repeated Key signed_keys = 14;
    repeated TransactionMember members = 17;
    BitcoinSpecific bitcoin_specific = 22;
    EthereumSpecific ethereum_specific = 20;
    LitecoinSpecific litecoin_specific = 23;
    BitcoincashSpecific bitcoincash_specific = 24;
    XrpSpecific xrp_specific = 21;
    google.protobuf.Timestamp create_time = 18;
    google.protobuf.Timestamp update_time = 19;
}

message TransactionMember {
    string account_id = 1;
    adamant.global.v1.AccountType account_type = 2;
    string name = 3;
    string email = 4;
    RoleType role = 5;
    bool signed = 6;
    bool validated = 7;
}

message TxInput {
    string tx_id = 1;
    uint32 tx_index = 2;
    double value = 3;
    string string_value = 4;
}

message TxOutput {
    string address = 1;
    double value = 2;
    string string_value = 3;
    bool is_change = 4;
}

message BitcoinSpecific {
    repeated TxInput tx_inputs = 1;
    repeated TxOutput tx_outputs = 2;
}

message LitecoinSpecific {
    repeated TxInput tx_inputs = 1;
    repeated TxOutput tx_outputs = 2;
}

message BitcoincashSpecific {
    repeated TxInput tx_inputs = 1;
    repeated TxOutput tx_outputs = 2;
}

message EthereumSpecific {
    uint64 gas_limit = 1;
    uint64 nonce = 2;
}

message XrpSpecific {
    uint32 sequence_number = 1;
    uint32 destination_tag = 2;
    gincoinc.global.v1.XRPTransactionType tx_type = 3;
}

message SignInfo {
    string wallet_id = 1;
    string transaction_id = 2;
    string key_id = 3;
    uint32 hd_account = 4;
    gincoinc.global.v1.Coin coin = 5;
    string tx_id = 6;
    uint32 sign_index = 11;
    string sign_message = 7;
    uint32 hd_change = 8;
    uint32 hd_index = 9;
    repeated SignTxInput sign_tx_inputs = 10;
}

message SignTxInput {
    uint32 tx_input_index = 1;
    string sign_message = 2;
    uint32 hd_change = 3;
    uint32 hd_index = 4;
}

// Transfer ...
message Transfer {
    string wallet_id = 1;
    string transfer_id = 2;
    gincoinc.global.v1.Coin coin = 3;
    string tx_id = 4;
    gincoinc.global.v1.TransferType transfer_type = 5;
    double value = 6;
    string string_value = 7;
    double jpy_rate = 9;
    string partner_wallet_id = 10;
    string partner_address = 11;
    uint32 destination_tag = 15;
    gincoinc.global.v1.TransactionState state = 12;
    gincoinc.global.v1.TransactionResult result = 16;
    google.protobuf.Timestamp create_time = 13;
    google.protobuf.Timestamp update_time = 14;
}

message Rate {
    gincoinc.global.v1.Coin coin = 1;
    double jpy = 2;
}

// map<k, v> ... k: enum number of Coin / v: Rate
message RateSnapshot {
    string rate_snapshot_id = 1 [(validate.rules).string = {pattern: "^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$"}];
    map<uint32, Rate> rates = 2 [(validate.rules).map.no_sparse = true];
}

message Deactivatability {
    string account_id = 1;
    bool deactivatable = 2;
}

message LabeledAddress {
    string labeled_address_id = 1;
    string name = 2;
    gincoinc.global.v1.Coin coin = 3;
    string address = 4;
    LabeledAddressProposal proposal = 5;
    bool is_deletable = 6;
    google.protobuf.Timestamp create_time = 7;
    google.protobuf.Timestamp update_time = 8;
}

message LabeledAddressProposal {
    string requester_account_id = 1 [(validate.rules).string = {pattern: "^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$"}];
    string requester_name = 2;
    string approver_account_id = 3;
    string approver_name = 4;
    string proposed_address = 5;
    bool address_is_reviewed = 6;
}

message Whitelist {
    string whitelist_id = 1;
    string name = 2;
    gincoinc.global.v1.Coin coin = 3;
    repeated LabeledAddress addresses = 4;
    bool is_deletable= 5;
    google.protobuf.Timestamp create_time = 6;
    google.protobuf.Timestamp update_time = 7;
}

message TransferLimit {
    string transfer_limit_id = 1;
    string name = 2;
    gincoinc.global.v1.Coin coin = 3;
    int64 hourly_limit = 4;
    int64 daily_limit = 5;
    int64 one_time_limit = 6;
    TransferLimitProposal proposal = 7;
    bool is_reviewed = 8;
    bool is_deletable = 9;
    google.protobuf.Timestamp create_time = 10;
    google.protobuf.Timestamp update_time = 11;
}

message TransferLimitProposal {
    string requester_account_id = 1;
    string requester_name = 2;
    string approver_account_id = 3;
    string approver_name = 4;
    int64 proposed_hourly_limit = 5;
    int64 proposed_daily_limit = 6;
    int64 proposed_one_time_limit = 7;
    bool is_reviewed = 8;
}

message Policy {
    string policy_id = 1;
    PolicyType policy_type = 2;
    string name = 3;
    bool is_base_policy = 4;
    gincoinc.global.v1.Coin coin = 5;
    Whitelist whitelist = 6;
    TransferLimit transfer_limit = 7;
    bool is_deletable = 8;
    PolicyProposal proposal = 11;
    google.protobuf.Timestamp create_time = 9;
    google.protobuf.Timestamp update_time = 10;
}

message PolicyProposal {
    string requester_account_id = 1;
    string requester_name = 2;
    string approver_account_id = 3;
    string approver_name = 4;
    Whitelist proposed_whitelist = 5;
    bool is_reviewed = 6;
}

message TotalBalanceByCoin {
    gincoinc.global.v1.Coin coin = 1;
    string cold_string_balance = 2;
    string hot_string_balance = 3;
}

// map<k, v> ... k: enum number of Coin / v: TotalBalanceByCoin
message TotalBalance {
    map<uint32, TotalBalanceByCoin> total_balances = 1 [(validate.rules).map.no_sparse = true];
}

// map<k, v> ... k: enum number of Coin / v: TotalBalanceByCoin
// map<k, v> ... k: enum number of Coin / v: Rate
message BalanceSnapshot {
    google.protobuf.Timestamp create_time = 1;
    map<uint32, TotalBalanceByCoin> total_balances = 2 [(validate.rules).map.no_sparse = true];
    map<uint32, Rate> rates = 3 [(validate.rules).map.no_sparse = true];
}

// =============================================================================
//  Request Model
// =============================================================================

message RequestTxOutput {
    string address = 1 [(validate.rules).string.min_len = 3];
    string string_value = 2 [(validate.rules).string.min_len = 1];
}

message RequestSignedInfo {
    repeated RequestSignature signatures = 1 [(validate.rules).repeated.min_items = 1];
}

message RequestSignature {
    uint32 sign_index = 1;
    string signature = 2 [(validate.rules).string.min_len = 1];
}

message RequestTransferLimitEntry {
    TransferLimitType transfer_limit_type = 1 [(validate.rules).enum = {defined_only: true, not_in: [0]}];
    int64 transfer_limit_value = 2 [(validate.rules).int64.gte = 0];
}

message RequestRate {
    gincoinc.global.v1.Coin coin = 1 [(validate.rules).enum = {defined_only: true, not_in: [0]}];
    double jpy = 2 [(validate.rules).double = {gte: 0}];
}
